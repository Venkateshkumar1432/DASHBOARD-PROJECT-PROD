# EV91 Platform - API Documentation (Gateway + Services)

Purpose: a concise, frontend-friendly summary of the API Gateway and the main backend service endpoints so frontend engineers can implement UI screens quickly.

NOTE: This document was generated by scanning the API Gateway and service routes in the repository. Paths below are the gateway-facing paths (what frontend should call). Some endpoints require authentication (gateway-enforced). See "How to use" and "Auth" sections.

## Quick start / base URLs

- API Gateway (local default): http://localhost:8000
- Common gateway endpoints:
  - Health: GET /health
  - Root: GET /
  - Docs (proxied to spare-parts service): GET /docs
  - OpenAPI YAML (proxied): GET /api-docs/yaml
  - OpenAPI JSON (proxied): GET /api-docs/json

By default the gateway proxies to individual services. The frontend should call the gateway paths below (no need to talk to services directly).

## Auth

- Gateway mounts auth routes at: /api/auth, /api/v1/auth and also proxies many auth-related routes (users, teams, departments, roles, permissions) to the auth service.
- The gateway applies authentication middleware to many routes (for example: /api/riders, /api/vehicles, /api/hubs, /api/cities, /api/spare-parts, /api/orders). If an endpoint is listed as "Auth: yes" assume a bearer token (Authorization: Bearer <token>) or X-API-Key may be required.
- Public endpoints (no auth) are typically: /health, some /docs endpoints, and the rider registration start/verify flows â€” check the call response for 401/403.

## How this document is organized

- Each section lists the gateway path, HTTP method, short description, whether auth is required (inferred from gateway), and request/response notes.

---

## ðŸ“‚ Endpoints

Method | Endpoint | Description | Request Body | Response | Auth Required
:--:|:--|:--|:--|:--|:--:
GET | /health | Gateway health check | â€” | { success: true, message, timestamp } | No
GET | / | Gateway root (endpoint map) | â€” | { success: true, endpoints: {...} } | No
GET | /docs | Proxied API docs (HTML from spare-parts service) | â€” | HTML page | No
GET | /api-docs/yaml | Proxied OpenAPI YAML | â€” | YAML spec | No

POST | /api/auth/login | Login (auth service) | { email or phone, password } | { success, token, user } | No
POST | /api/auth/logout | Logout | â€” | { success } | Yes
GET | /api/users | List users (auth service) | query params | { success, data: [] } | Yes

POST | /api/riders/rider-register/start | Start registration â€” send OTP | { phone } | { success, message } | No
POST | /api/riders/rider-register/verify-otp | Verify OTP | { phone, otp } | { success, token? } | No
POST | /api/riders/rider-register/resend-otp | Resend OTP | { phone } | { success } | No
GET | /api/riders/rider-register/status/:phone | Get registration status by phone | â€” | { success, status } | No

POST | /api/riders/rider-register/profile/:riderId | Save rider profile | { name, dob, address1, city, state, pincode, ... } | { success, data } | Yes
GET | /api/riders/rider-register/profile/:riderId | Get rider profile | â€” | { success, data } | Yes

POST | /api/riders/rider-register/kyc/document/:riderId/:documentType | Upload KYC document (multipart/form-data) | file + documentNumber | { success, fileUrl } | Yes
POST | /api/riders/rider-register/kyc/submit/:riderId | Submit KYC for review | â€” | { success, status: 'under_review' } | Yes

GET | /api/riders/riders | List riders (admin) | query: page, limit, search, registrationStatus, kycStatus, city, sortBy | { success, data: [], pagination } | Yes
POST | /api/riders/riders | Create rider (admin) | { phone, name, aadhaar, pan, dl, emergencyName, emergencyPhone, ... } | { success, data } | Yes
GET | /api/riders/riders/:riderId | Get rider details | â€” | { success, data } | Yes
PUT | /api/riders/riders/:riderId | Update rider | { fields to update } | { success, data } | Yes
PATCH | /api/riders/riders/:riderId/status | Update rider status | { isActive, status } | { success } | Yes

GET | /api/vehicles | List vehicles | query params | { success, data: [] } | Yes
GET | /api/vehicles/stats | Vehicle stats / analytics | â€” | { success, data } | Yes

GET | /api/hubs | List hubs | â€” | { success, data } | Yes
POST | /api/hubs | Create hub | { name, cityId, address, ... } | { success, data } | Yes
POST | /api/hubs/assign-vehicle | Assign vehicle to hub | { hubId, vehicleId } | { success } | Yes

GET | /api/cities | List cities | â€” | { success, data } | Yes
GET | /api/cities/operational | Operational cities | â€” | { success, data } | Yes
GET | /api/cities/with-counts | Cities with vehicle counts | â€” | { success, data } | Yes

GET | /api/vehicles/damage | List damage records | query params | { success, data } | Yes
POST | /api/vehicles/damage | Create damage record | { vehicleId, damageType, severity, location, description, reportedBy } | { success, data } | Yes

POST | /api/vehicles/vehicles/:vehicleId/documents | Upload vehicle document (multipart/form-data) | file(s) | { success, files: [...] } | Yes
PATCH | /api/vehicles/documents/:documentId/verification | Update doc verification | { status, notes } | { success } | Yes

GET | /api/spare-parts/health | Spare-parts health | â€” | { status: 'healthy' } | No
GET | /api/spare-parts | List spare parts / search | query params | { success, data } | Yes
POST | /api/spare-parts | Create spare part | { name, sku, price, inventory } | { success, data } | Yes

POST | /api/orders | Create order | { items: [...], customerId, address, payment } | { success, data } | Yes
GET | /api/orders | List orders | query params | { success, data } | Yes
GET | /api/orders/:id | Get order details | â€” | { success, data } | Yes

## Endpoint details

Below are concrete request and response examples for the most-used gateway endpoints. Use these to build forms, HTTP calls, and error handling in the frontend.

### POST /api/auth/login
- Auth: No
- Request (application/json):
```json
{
  "email": "alice@example.com",
  "password": "s3cr3t"
}
```
- Success response (200):
```json
{
  "success": true,
  "token": "eyJhbGci...",
  "user": { "id": "u_123", "name": "Alice", "roles": ["admin"] }
}
```
- Error (401): { "success": false, "message": "Invalid credentials" }

### POST /api/riders/rider-register/start
- Auth: No
- Request (application/json):
```json
{ "phone": "+919876543210" }
```
- Success (200): { "success": true, "message": "OTP sent" }
- Error (400): { "success": false, "message": "Invalid phone number" }

### POST /api/riders/rider-register/verify-otp
- Auth: No
- Request (application/json):
```json
{ "phone": "+919876543210", "otp": "123456" }
```
- Success (200): may include a temporary token or rider id
```json
{ "success": true, "riderId": "r_123", "message": "OTP verified" }
```
- Error (400/401): { "success": false, "message": "Invalid OTP" }

### POST /api/riders/rider-register/profile/:riderId
- Auth: Usually Yes (include Authorization header)
- Request (application/json):
```json
{
  "name": "Sanjay Kumar",
  "dob": "1990-05-10",
  "address1": "123 MG Road",
  "address2": "Near Park",
  "city": "Bengaluru",
  "state": "Karnataka",
  "pincode": "560001",
  "emergencyName": "Ramesh",
  "emergencyPhone": "+919812345678",
  "emergencyRelation": "Brother"
}
```
- Success (200): { "success": true, "data": { /* saved profile */ } }
- Error (400): { "success": false, "message": "Missing required fields" }

### POST /api/riders/rider-register/kyc/document/:riderId/:documentType
- Auth: Yes
- Request: multipart/form-data
  - file field name: `file`
  - other fields: `documentNumber` (optional)
  - documentType: `aadhaar`, `pan`, `dl`, `selfie`
- Success (200):
```json
{ "success": true, "fileUrl": "https://s3.example.com/riders/r_123/aadhaar.jpg" }
```
- Notes: Use a form POST with enctype multipart/form-data. Expect longer upload timeouts.

### GET /api/riders/riders (admin list)
- Auth: Yes (admin)
- Query params: `page`, `limit`, `search`, `registrationStatus`, `kycStatus`, `city`, `sortBy`, `sortOrder`
- Success (200):
```json
{
  "success": true,
  "data": [ { "id": "r_123", "name": "Sanjay", "phone": "+91...", "isActive": true } ],
  "pagination": { "page": 1, "limit": 10, "totalItems": 42, "totalPages": 5 }
}
```

### POST /api/riders/riders (create rider admin)
- Auth: Yes
- Request (application/json):
```json
{
  "name": "Sanjay Kumar",
  "phone": "+919876543210",
  "dob": "1990-05-10",
  "address1": "...",
  "city": "Bengaluru",
  "aadhaarNumber": "XXXX-XXXX-XXXX",
  "panNumber": "ABCDE1234F",
  "drivingLicenseNumber": "DL-1234567890",
  "emergencyName": "Ramesh",
  "emergencyPhone": "+919812345678",
  "emergencyRelation": "Brother"
}
```
- Success (201): { "success": true, "message": "Rider created", "data": { "id": "r_124", ... } }

### GET /api/riders/riders/:riderId
- Auth: Yes
- Success (200):
```json
{ "success": true, "data": { "id": "r_123", "name": "Sanjay", "phone": "+91...", "isActive": true, "assignedVehicleId": null } }
```

### PUT /api/riders/riders/:riderId
- Auth: Yes
- Request (application/json): partial or full rider fields (same as create)
- Success (200): { "success": true, "data": { /* updated rider */ } }

### PATCH /api/riders/riders/:riderId/status
- Auth: Yes
- Request (application/json):
```json
{ "isActive": true }
```
- Success (200): { "success": true }

### Vehicles: GET /api/vehicles
- Auth: Yes
- Query params: `page`, `limit`, `hubId`, `status`, `search`
- Success (200): { "success": true, "data": [ { "id": "v_1", "model": "Hero Optima", "status": "available" } ] }

### Hubs: POST /api/hubs
- Auth: Yes
- Request (application/json): { "name": "Hub A", "cityId": "c_1", "address": "..." }
- Success (201): { "success": true, "data": { "id": "h_1", ... } }

### Cities: GET /api/cities/operational
- Auth: Yes
- Success (200): { "success": true, "data": [ { "id": "c_1", "name": "Bengaluru" } ] }

### Damage records: POST /api/vehicles/damage
- Auth: Yes
- Request (application/json):
```json
{
  "vehicleId": "v_123",
  "damageType": "Cosmetic",
  "severity": "Minor",
  "location": "Left side",
  "description": "Scratch near tail light",
  "reportedBy": "r_123",
  "estimatedCost": 1500
}
```
- Success (201): { "success": true, "data": { "id": "d_1", ... } }

### Vehicle documents upload: POST /api/vehicles/vehicles/:vehicleId/documents
- Auth: Yes
- Request: multipart/form-data with `files` (max 10) or single `file` field
- Success (200): { "success": true, "files": [ { "documentId": "doc_1", "url": "..." } ] }

### Spare-parts list: GET /api/spare-parts
- Auth: Yes
- Query params: `search`, `category`, `page`, `limit`
- Success (200): { "success": true, "data": [ { "id": "sp_1", "name": "Brake Pad", "sku": "BP-001", "price": 250 } ] }

### Orders: POST /api/orders
- Auth: Yes
- Request (application/json):
```json
{
  "customerId": "c_123",
  "items": [ { "sparePartId": "sp_1", "quantity": 2 } ],
  "address": { "line1": "...", "city": "...", "pincode": "..." },
  "payment": { "method": "COD" }
}
```
- Success (201): { "success": true, "data": { "orderId": "o_123", "status": "created" } }

---

## Auth service (detailed)

### POST /api/v1/auth/signup
- Auth: No
- Request (application/json):
```json
{
  "name": "Alice",
  "email": "alice@example.com",
  "phone": "+919800000000",
  "password": "Secur3P@ss"
}
```
- Success (201):
```json
{ "success": true, "message": "Verification email sent", "userId": "u_123" }
```

### POST /api/v1/auth/login
- Auth: No
- Request (application/json):
```json
{ "email": "alice@example.com", "password": "Secur3P@ss" }
```
- Success (200):
```json
{ "success": true, "token": "eyJhbGci...", "refreshToken": "r_abc", "user": { "id":"u_123","name":"Alice" } }
```

### POST /api/v1/auth/refresh-token
- Auth: No (uses refresh token in body)
- Request:
```json
{ "refreshToken": "r_abc" }
```
- Success (200): { "success": true, "token": "eyJhbGci..." }

### GET /api/v1/auth/profile
- Auth: Yes (Authorization: Bearer <token>)
- Success (200):
```json
{ "success": true, "data": { "id": "u_123", "email": "alice@example.com", "name": "Alice", "roles": ["admin"] } }
```

### POST /api/v1/auth/logout
- Auth: Yes
- Request: { }
- Success (200): { "success": true, "message": "Logged out" }

### POST /api/v1/auth/forgot-password
- Auth: No
- Request: { "email": "alice@example.com" }
- Success (200): { "success": true, "message": "Password reset email sent" }

### POST /api/v1/auth/reset-password
- Auth: No
- Request: { "token": "reset_token", "newPassword": "NewP@ss" }
- Success (200): { "success": true, "message": "Password updated" }

### Admin: POST /api/v1/auth/register (create user)
- Auth: Yes (admin)
- Request: similar to signup but may include role assignments
- Success (201): { "success": true, "data": { "id": "u_124" } }

---

## Employee & Admin routes (auth-service)

These endpoints are mounted under `/api/v1` and usually require employee authentication (internal JWT) and permission checks.

### POST /api/v1/employees/login
- Auth: No (employee login)
- Request: { "email": "emp@example.com", "password": "..." }
- Success: { "success": true, "token": "eyJ...", "employee": { "id": "e_1", "name": "Zoya" } }

### POST /api/v1/employees
- Auth: Yes (admin)
- Request (application/json):
```json
{
  "name": "Raj",
  "email": "raj@company.com",
  "phone": "+919700000000",
  "roleIds": ["role_admin"],
  "departmentId": "d_1"
}
```
- Success (201): { "success": true, "data": { "id": "emp_123" } }

### GET /api/v1/employees/me
- Auth: Yes
- Success (200): { "success": true, "data": { "id": "emp_123", "name": "Raj" } }

### GET /api/v1/employees/:id
- Auth: Yes (permission read)
- Success: { "success": true, "data": { /* employee object */ } }

### PUT /api/v1/employees/:id
- Auth: Yes
- Request: partial employee update
- Success: { "success": true, "data": { /* updated */ } }

### DELETE /api/v1/employees/:id/deactivate
- Auth: Yes
- Success: { "success": true }

### Department routes example
- POST /api/v1/departments
  - Auth: Yes (admin)
  - Request: { "name": "Operations", "parentId": null }
  - Success: { "success": true, "data": { "id": "d_10" } }

---

## Client & Store service (detailed)

These endpoints are mounted behind the gateway at `/api` (gateway routes `/api/clients`, `/api/stores`, `/api/cities`).

### Clients

GET /api/clients
- Auth: Partial (some endpoints public, but gateway applies auth for many calls)
- Query: `search`, `city`, `page`, `limit`
- Success:
```json
{ "success": true, "data": [ { "id": "c_1", "name": "Client A", "city": "Bengaluru" } ] }
```

POST /api/clients
- Auth: Yes (Admin/Manager)
- Request:
```json
{ "name": "Client A", "contactEmail": "pm@client.com", "city": "Bengaluru", "accountManagerId": "emp_12" }
```
- Success (201): { "success": true, "data": { "id": "c_10" } }

GET /api/clients/:id
- Auth: Depends (usually protected)
- Success: { "success": true, "data": { /* client object */ } }

### Stores

GET /api/stores
- Auth: public/basic
- Query: `clientId`, `cityId`, `page`, `limit`
- Success: { "success": true, "data": [ { "id": "s_1", "name": "Store 1", "clientId": "c_1" } ] }

POST /api/stores
- Auth: Yes (requireRole Admin/Manager)
- Request:
```json
{ "name": "Store 1", "clientId": "c_1", "cityId": "c_1", "address": "...", "managerId": "emp_5" }
```
- Success (201): { "success": true, "data": { "id": "s_10" } }

PUT /api/stores/:id
- Auth: Yes (require roles)
- Request: partial store update
- Success: { "success": true, "data": { /* updated store */ } }

DELETE /api/stores/:id
- Auth: Yes (Admin)
- Success: { "success": true }

### Cities (client-store)
- GET /api/cities
  - Auth: public/basic
  - Success: { "success": true, "data": [ { "id": "c_1", "name": "Bengaluru" } ] }

---

## Spare-parts service (detailed)

The gateway proxies `/api/spare-parts` routes to the spare-parts service. Most endpoints require auth.

### GET /api/spare-parts
- Auth: Yes
- Query params: `search`, `category`, `page`, `limit`, `sort`
- Success:
```json
{ "success": true, "data": [ { "id": "sp_1", "name": "Brake Pad", "sku": "BP-001", "price": 250 } ], "pagination": { "page":1 } }
```

### GET /api/spare-parts/:id
- Auth: Yes
- Success: { "success": true, "data": { "id": "sp_1", "name": "Brake Pad", "price": 250 } }

### POST /api/spare-parts
- Auth: Yes
- Request:
```json
{ "name": "Brake Pad", "sku": "BP-001", "category": "Brakes", "price": 250, "initialStock": 100 }
```
- Success (201): { "success": true, "data": { "id": "sp_100" } }

### PATCH /api/spare-parts/:id/pricing
- Auth: Yes
- Request: { "price": 275 }
- Success: { "success": true, "data": { "id": "sp_1", "price": 275 } }

### POST /api/spare-parts/bulk-update
- Auth: Yes
- Request: { "items": [ { "id": "sp_1", "price": 260 }, { "id": "sp_2", "price": 180 } ] }
- Success: { "success": true, "updated": 2 }

### GET /api/spare-parts/:id/price-history
- Auth: Yes
- Success: { "success": true, "data": [ { "price": 240, "date": "2025-07-01" } ] }

---

## Inventory (spare-parts) endpoints

### GET /api/inventory/stock-levels
- Auth: Yes
- Success: { "success": true, "data": [ { "storeId": "s_1", "sparePartId": "sp_1", "qty": 12 } ] }

### POST /api/inventory/stock-movement
- Auth: Yes
- Request:
```json
{ "storeId": "s_1", "sparePartId": "sp_1", "change": -2, "reason": "order o_12" }
```
- Success: { "success": true, "movementId": "m_1" }

### POST /api/inventory/reserve-stock
- Auth: Yes
- Request: { "storeId": "s_1", "sparePartId": "sp_1", "qty": 2, "reference": "order_o_123" }
- Success: { "success": true, "reservationId": "res_1" }

### POST /api/inventory/release-stock
- Auth: Yes
- Request: { "reservationId": "res_1" }
- Success: { "success": true }

### POST /api/inventory/stock-count
- Auth: Yes
- Request: { "storeId": "s_1", "counts": [ { "sparePartId": "sp_1", "qty": 10 } ] }
- Success: { "success": true, "adjustments": [ { "sparePartId": "sp_1", "delta": -2 } ] }

---

## Vehicle service (detailed)

Gateway mounts vehicle routes under `/api/vehicles` (proxied to vehicle-service `/api/v1`). Below are common frontend-facing payloads and responses.

### POST /api/vehicles
- Auth: Yes (usually)
- Purpose: Create a vehicle record
- Request (application/json):
```json
{
  "modelId": "vm_123",
  "registrationNumber": "KA01AB1234",
  "color": "White",
  "hubId": "h_10",
  "year": 2024,
  "batteryCapacity": 3.5,
  "purchaseDate": "2024-05-01"
}
```
- Success (201):
```json
{ "success": true, "data": { "id": "v_123", "registrationNumber": "KA01AB1234" } }
```

### GET /api/vehicles
- Auth: Yes
- Query params: `page`, `limit`, `hubId`, `operationalStatus`, `search`
- Success (200):
```json
{
  "success": true,
  "data": [ { "id":"v_123","registrationNumber":"KA01AB1234","status":"Available" } ],
  "pagination": { "page": 1, "limit": 20, "totalItems": 100 }
}
```

### GET /api/vehicles/:id
- Auth: Yes (optionalAuth may allow limited public view)
- Success (200):
```json
{ "success": true, "data": { "id":"v_123","modelId":"vm_123","registrationNumber":"KA01AB1234","assignedRiderId": "r_10","isActive": true } }
```

### PUT /api/vehicles/:id
- Auth: Yes
- Request: same fields as create (partial allowed)
- Success (200): { "success": true, "data": { /* updated vehicle */ } }

### PATCH /api/vehicles/:id/status
- Auth: Yes
- Request (application/json):
```json
{ "operationalStatus": "Assigned", "serviceStatus": "Active", "reason": "Assigned to rider r_10" }
```
- Success (200): { "success": true, "message": "Status updated" }

### POST /api/vehicles/:id/assign
- Auth: Yes
- Request:
```json
{ "riderId": "r_10", "assignmentNotes": "Assigned for deliveries" }
```
- Success: { "success": true, "data": { "id": "v_123", "assignedRiderId": "r_10" } }

### POST /api/vehicles/:id/unassign
- Auth: Yes
- Success: { "success": true }

### GET /api/vehicles/:id/history
- Auth: Yes
- Success: { "success": true, "data": [ { "type":"assignment","when":"2025-07-01T10:00:00Z","by":"emp_1","details":{...} } ] }

---

## Vehicle service - Service records (maintenance)

These are mounted at `/api/vehicles/service` or via the enhanced service routes. Gateway may expose via `/api/vehicles/service` or `/api/service` depending on gateway mapping.

### POST /api/service/records
- Auth: Yes
- Request:
```json
{
  "vehicleId": "v_123",
  "serviceType": "Periodic",
  "scheduledAt": "2025-10-15T09:00:00Z",
  "notes": "30k km service",
  "costEstimate": 1500
}
```
- Success (201): { "success": true, "data": { "id": "sr_1", "status": "scheduled" } }

### GET /api/service/records?vehicleId=v_123
- Auth: Yes
- Success: { "success": true, "data": [ { "id":"sr_1","vehicleId":"v_123","status":"completed" } ] }

### POST /api/service/records/:serviceRecordId/media
- Auth: Yes
- Request: multipart/form-data `files` (max 10)
- Success: { "success": true, "files": [ { "documentId":"doc_1","url":"..." } ] }

### GET /api/service/records/:serviceRecordId/media
- Auth: Yes
- Success: { "success": true, "data": [ { "id":"m_1","url":"..." } ] }

---

## Documents & Media

### POST /api/vehicles/vehicles/:vehicleId/documents
- Auth: Yes
- Request: multipart/form-data: `file` (single) or `files` (batch)
- Success: { "success": true, "files": [ { "documentId": "doc_1", "url": "..." } ] }

### GET /api/vehicles/vehicles/:vehicleId/documents
- Auth: Yes
- Success: { "success": true, "data": [ { "documentId":"doc_1","type":"registration","url":"..." } ] }

### PATCH /api/vehicles/documents/:documentId/verification
- Auth: Yes
- Request: { "status": "verified", "notes": "OK" }
- Success: { "success": true }

---

## Damage management

### GET /api/vehicles/damage
- Auth: Yes
- Query: `page`, `limit`, `vehicleId`, `status`
- Success: { "success": true, "data": [ { "id":"d_1","vehicleId":"v_123","severity":"Minor" } ] }

### POST /api/vehicles/damage
- Auth: Yes
- Request:
```json
{
  "vehicleId": "v_123",
  "damageType": "Cosmetic",
  "severity": "Minor",
  "location": "Left side",
  "description": "Scratch",
  "reportedBy": "r_123",
  "estimatedCost": 1200
}
```
- Success (201): { "success": true, "data": { "id": "d_1" } }

### PATCH /api/vehicles/damage/:id/status
- Auth: Yes
- Request: { "status": "In Repair", "technician": "tech_1", "notes": "Part ordered" }
- Success: { "success": true }

---

## Handover (assign/return)

### POST /api/vehicles/handover/:id/assign
- Auth: Yes
- Request: { "riderId": "r_123", "assignedBy": "emp_1", "notes": "New assignment" }
- Success: { "success": true, "handoverId": "ho_1" }

### POST /api/vehicles/handover/:id/return
- Auth: Yes
- Request: { "returnedBy": "r_123", "condition": "Good", "notes": "Returned after shift" }
- Success: { "success": true }

### GET /api/vehicles/handover/:id/history
- Auth: Yes
- Success: { "success": true, "data": [ { "type":"assign","when":"..." } ] }

---

## Hubs, OEMs & Models

### GET /api/hubs
- Auth: Yes
- Success: { "success": true, "data": [ { "id":"h_1","name":"Hub A" } ] }

### POST /api/hubs
- Auth: Yes
- Request: { "name": "Hub A", "cityId": "c_1", "address": "..." }
- Success: { "success": true, "data": { "id": "h_10" } }

### GET /api/vehicle-models
- Auth: Yes
- Success: { "success": true, "data": [ { "id":"vm_1","name":"Model X" } ] }

### OEMs (GET/POST/PUT/DELETE)
- Standard CRUD on `/api/oems` â€” create with { name, country, contact } and responses follow { success, data }

---

## Unified Service (service requests)

These endpoints manage service requests (create requests, approvals, part usage) under `/api/vehicles/unified-service` or proxied path.

### POST /api/unified-service/requests
- Auth: Yes
- Request:
```json
{ "vehicleId": "v_123", "requestedBy": "emp_1", "reason": "Battery check", "priority": "normal" }
```
- Success (201): { "success": true, "data": { "id": "req_1", "status": "open" } }

### POST /api/unified-service/requests/:id/approval
- Auth: Yes
- Request: { "approved": true, "approvedBy": "emp_2", "notes": "Proceed" }
- Success: { "success": true }

### POST /api/unified-service/requests/:id/parts
- Auth: Yes
- Request: { "parts": [ { "sparePartId": "sp_1", "qty": 1 } ] }
- Success: { "success": true, "partsRequested": 1 }

---



## 1) Auth service (gateway path: /api/auth, /api/users, /api/teams, /api/departments, /api/roles, /api/permissions)

- POST /api/auth/login
  - Desc: Login (proxy to auth service)
  - Auth: no
  - Body: { email | phone, password }
  - Response: success + token / user info

- POST /api/auth/logout
  - Desc: Logout
  - Auth: yes

- GET /api/users
  - Desc: list users (proxied)
  - Auth: yes

- GET /api/teams, POST /api/teams
  - Desc: teams CRUD (proxied)
  - Auth: yes

- GET /api/departments
  - Desc: departments (proxied)
  - Auth: yes

Note: Auth service contains many admin/internal endpoints used by the admin portal; consult `services/auth-service/README.md` for details if needed.

---

## 2) Rider service (gateway path: /api/riders/*)

Gateway proxies rider requests to the Rider Service (internal /api/v1/*). The gateway registers authentication for `/api/riders` so many endpoints require auth.

Core (Registration & KYC):

- POST /api/riders/rider-register/start
  - Desc: Start registration (send OTP)
  - Auth: no (public mobile flow)
  - Body: { phone }

- POST /api/riders/rider-register/verify-otp
  - Desc: Verify OTP
  - Auth: no
  - Body: { phone, otp }

- POST /api/riders/rider-register/resend-otp
  - Desc: Resend OTP
  - Auth: no

- GET /api/riders/rider-register/status/:phone
  - Desc: Get registration status for a phone
  - Auth: no

Profile & KYC (some public, uploads may be proxied via gateway but often require auth):

- POST /api/riders/rider-register/profile/:riderId
  - Desc: Save rider profile
  - Auth: yes (depends on how gateway is configured)
  - Body: profile fields (name, dob, address, etc.)

- GET /api/riders/rider-register/profile/:riderId
  - Desc: Get rider profile
  - Auth: yes

- POST /api/riders/rider-register/kyc/document/:riderId/:documentType
  - Desc: Upload KYC document (multipart/form-data)
  - Auth: yes (KYC upload has larger timeout)
  - documentType examples: aadhaar, pan, dl, selfie

- POST /api/riders/rider-register/kyc/submit/:riderId
  - Desc: Submit KYC for review
  - Auth: yes

Admin rider management (Admin APIs):

- GET /api/riders/riders
  - Desc: List riders (filtering, pagination, search)
  - Auth: yes (admin)
  - Query: page, limit, search, registrationStatus, kycStatus, city, sortBy, sortOrder

- POST /api/riders/riders
  - Desc: Create rider (admin)
  - Auth: yes
  - Body: rider details (phone, name, aadhar, pan, dl, emergency contact, etc.)

- GET /api/riders/riders/:riderId
  - Desc: Get rider details
  - Auth: yes

- PUT /api/riders/riders/:riderId
  - Desc: Update rider
  - Auth: yes

- PATCH /api/riders/riders/:riderId/status
  - Desc: Update rider status (active/inactive and other status updates)
  - Auth: yes

- GET /api/riders/riders/:riderId/kyc
  - Desc: Get rider KYC documents
  - Auth: yes

Notes: KYC admin endpoints (verify, auto-verify) are exposed under `/api/riders/*` and may require admin roles. The gateway sets a higher timeout for KYC uploads.

---

## 3) Vehicle & Hubs (gateway paths: /api/vehicles, /api/hubs, /api/cities)

The gateway proxies vehicle/hub/city requests to the Vehicle Service. Gateway applies auth to these paths.

Common endpoints (gateway-facing):

- GET /api/vehicles/health
  - Desc: Health for vehicle service
  - Auth: no (health endpoints are usually public)

- GET /api/vehicles (maps to vehicle list /api/v1/vehicles)
  - Desc: List vehicles
  - Auth: yes

- GET /api/vehicles/stats or /api/vehicles/analytics
  - Desc: Vehicle analytics / stats
  - Auth: yes

- Hubs & Cities:
  - GET /api/hubs/ -> list hubs
  - POST /api/hubs/ -> create hub
  - POST /api/hubs/assign-vehicle -> assign vehicle to hub
  - GET /api/cities/ -> list cities
  - POST /api/cities/ -> create city
  - GET /api/cities/operational -> operational cities
  - GET /api/cities/with-counts -> cities with vehicle counts
  - Auth: yes for management endpoints

- Damage & Documents:
  - GET /api/vehicles/damage -> list damage records
  - GET /api/vehicles/damage/:id -> damage record
  - POST /api/vehicles/damage -> create damage record
  - PATCH /api/vehicles/documents/:documentId/verification -> update verification
  - POST /api/vehicles/vehicles/:vehicleId/documents -> upload vehicle document

---

## 4) Spare-parts service (gateway path: /api/spare-parts/*)

- GET /api/spare-parts/health
  - Desc: health
  - Auth: no

- GET /api/spare-parts/docs (gateway /docs proxies here)
  - Desc: Swagger UI (served by spare-parts service)
  - Auth: no

- Main resource groups (auth required):
  - /api/spare-parts (spare parts CRUD)
  - /api/inventory
  - /api/suppliers
  - /api/purchase-orders
  - /api/analytics
  - /api/dashboard

---

## 5) Orders (gateway path: /api/orders/*)

- All order routes are proxied by the gateway to the order service. Typical patterns:
  - POST /api/orders -> create order
  - GET /api/orders -> list orders
  - GET /api/orders/:id -> get order
  - PUT/PATCH /api/orders/:id -> update order
  - Auth: yes

---

## Example usage & tips for frontend

- Use gateway base: http://localhost:8000
- Public endpoints to start user flows: registration (/api/riders/rider-register/start), health (/health), docs (/docs)
- For protected endpoints include Authorization header: `Authorization: Bearer <token>`
- For file uploads use multipart/form-data and expect longer timeouts (KYC uploads are allowed more time)
- When in doubt, call GET / to see gateway-provided endpoint map

## Assumptions & notes

- This doc was created by scanning the API Gateway and service route files present in the repository. I inferred gateway-facing paths by following how the gateway mounts each router and by reading route definitions inside services.
- Default service URLs used by the gateway (in code) include e.g.:
  - Auth service: http://localhost:4001
  - Vehicle service: http://localhost:4004 (other files mention 4002/4003 - check service envs)
  - Rider service: http://localhost:4005
  - Spare-parts service: http://localhost:4006 (spare parts service code uses 4006)
  - Order service: (gateway uses ORDER_SERVICE_URL, check .env or docker-compose)
- The gateway often enforces auth on routes; some service internal routes may be public if called directly. Always verify by calling the endpoint and checking status codes.

## Next steps (recommended)

1. Generate full OpenAPI specs from each service (many services already contain swagger/openapi artifacts) and aggregate them behind the gateway /api-docs endpoints.
2. Add example request/response bodies for each endpoint used by the frontend screens.
3. Mark role/permission requirements per endpoint (admin vs public) and add sample JWT or API key usage.

---

## Checklist (requirements extracted from your request)

- [x] Collect all backend and gateway endpoints and group them by service (Done - scanned gateway + services)
- [x] Produce a README with routes and how frontend should call them (Done - this file)
- [x] Note auth requirements and public endpoints (Done - Auth section + per-endpoint notes)
- [ ] Add full request/response examples for every endpoint (Deferred - requires OpenAPI or manual examples)

If you want, I can now:
- generate per-service OpenAPI snippets for the frontend screens you plan to build, or
- create a smaller, endpoint-by-endpoint JSON file the frontend can import (example: a routes manifest).

---

File: `API_DOCUMENTATION.md` created at repository root. If you'd like it placed inside a particular app (for example `apps/api-gateway/README.md`) I can move it.

Generated: automated scan of route files in repository (api-gateway and services).
